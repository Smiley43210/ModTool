<!DOCTYPE html>
<html>
	<head>
		<meta charset='UTF-8'>
		<title>RedPack</title>
		<link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500|Roboto+Mono' rel='stylesheet'>
		<link href='https://fonts.googleapis.com/icon?family=Material+Icons' rel='stylesheet'>
		<link href='https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css' rel='stylesheet'>
		<link href='style/style.css' rel='stylesheet'>
		<link href='style/mdc.css' rel='stylesheet'>
		<link href='style/progress.css' rel='stylesheet'>
		<script src='https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js'></script>
		<script type='module'>
			class ProgressElement extends HTMLElement {
				set value(value) {
					if (value) {
						this.setAttribute('value', value);
					} else {
						this.removeAttribute('value');
					}
				}
				
				get value() {
					return this._value;
				}
				
				set message(value) {
					this._messageElement.innerHTML = value;
				}
				
				constructor() {
					super();
					
					this._maxValue = 1;
					this._value = null;
					
					let shadow = this.attachShadow({mode: 'open'});
					this._shadowElement = shadow;
					let messageElement = document.createElement('div');
					this._messageElement = messageElement;
					let progressElement = document.createElement('div');
					progressElement.className = 'progress';
					let valueElement = document.createElement('div');
					this._valueElement = valueElement;
					valueElement.className = 'value';
					let style = document.createElement('style');
					style.textContent = `
:host {
	display: block;
}

:host(:not([value])) .value {
	animation: indefinite 2.5s linear infinite;
}

.progress {
	box-sizing: border-box;
	display: inline-block;
	margin: 5px 0 10px 0;
	height: 1em;
	width: 100%;
	vertical-align: -0.2em;
	
	background: #5f5f5f;
	overflow: hidden;
}

.value {
	height: 100%;
	background: var(--mdc-theme-accent);
}

@keyframes indefinite {
	0% {
		width: 50%;
		margin-left: -50%;
	}

	100% {
		width: 50%;
		margin-left: 100%;
	}
}
`;
					
					shadow.appendChild(style);
					shadow.appendChild(messageElement);
					shadow.appendChild(progressElement);
					progressElement.appendChild(valueElement);
					
					let observer = new MutationObserver((records, observer) => {
						return this.observationCallback(records, observer);
					});
					let observationConfig = {attributeFilter: ['value', 'max'], attributes: true};
					observer.observe(this, observationConfig);
				}
				
				connectedCallback() {
					this.update();
				}
				
				observationCallback() {
					this.update();
				}
				
				update() {
					this._maxValue = this.hasAttribute('max') ? Number(this.getAttribute('max')) : 1;
					this._value = this.hasAttribute('value') ? Number(this.getAttribute('value')) : null;
					
					if (this._value) {
						let percent = this._value / this._maxValue * 100;
						
						this._valueElement.style.width = `${percent}%`;
					}
				}
				
				addProgress() {
					let progress = new ProgressElement();
					this._shadowElement.appendChild(progress);
					return progress;
				}
				
				remove() {
					this.parentNode.removeChild(this);
				}
			}
				
			customElements.define('progress-element', ProgressElement);
		</script>
	</head>
	<body>
		<main>
			<div id='pack-select' class='sidebar'>
				<header><h1>Modpacks</h1></header>
			</div>
			<div class='content'>
				<div>
					<h1 id='pack-name'>Loading...</h1>
					<div id='pack-about' class='group' data-label='About' style='display: none; margin-top: 0;'>
						<div id='pack-description'></div>
						<div style='padding-top: 10px;'>
							Minecraft <span id='pack-minecraft-version'></span>
						</div>
					</div>
					<div style='display: flex; padding-bottom: 10px;'>
						<div style='flex: 1; margin-top: 10px; margin-right: 5px;'>
							<button disabled id='pack-install-client' class='mdc-button mdc-button--raised mdc-button--accent' style='display: block; width: 100%;'>
								<span class='mdc-button__label'>Install Client</span>
							</button>
							<div class='check' id='client-install-check'></div>
						</div>
						<div style="flex: 1; margin-top: 10px; margin-left: 5px;">
							<button disabled id='pack-install-server' class='mdc-button mdc-button--raised mdc-button--accent' style='display: block; width: 100%;'>
								<span class='mdc-button__label'>Install Server</span>
							</button>
							<div class='check' id='server-install-check'></div>
						</div>
					</div>
					<div id='progress' class='group' style='display: none;' data-label="Progress">
						<progress-element id='progress-main'></progress-element>
					</div>
					<button id='advanced-toggle' class='mdc-button mdc-button--raised' style='display: block; width: 100%;'>
						<span class='mdc-button__label'>Show Advanced Settings</span>
						<i class="material-icons mdc-button__icon" aria-hidden="true">keyboard_arrow_down</i>
					</button>
					<div id='advanced-settings' style='display: none; padding-top: 10px;'>
						<div>Installation directory:</div>
						<span id='install-dir' style='font-family: "Roboto Mono", monospace; font-size: 0.85em;'></span>
						<button id='install-change' class='mdc-button mdc-button--raised' style='margin-left: 5px;'>
							<span class='mdc-button__label'>Change...</span>
						</button>
					</div>
				</div>
			</div>
			<div id='debug' style='position: fixed; bottom: 0; right: 0; width: 32px; height: 32px;'></div>
		</main>

		<!-- You can also require other files to run in this process -->
		<script src='./renderer.js'></script>
	</body>
</html>
